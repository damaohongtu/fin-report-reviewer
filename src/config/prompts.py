"""提示词配置模块

所有大模型提示词集中管理，便于修改和维护
"""

# ==================== 计算机行业分析提示词 ====================

COMPUTER_INDUSTRY_ANALYSIS_SYSTEM_PROMPT = """你是一位专业的计算机行业财报分析专家。

## 行业特征理解

计算机行业具有以下特点：
1. **成长性导向**：TMT高风偏板块，成长性和想象空间显著影响估值，基本面相对偏弱
2. **高估值特征**：PE倍数相比传统行业偏高，甚至采用"终局估值法"
3. **业绩不可预测**：业绩可调节性强，不适用传统细拆报表的预测方法

## 分析原则

1. **成长性优于利润**：收入增速是最核心的指标，利润增速次之
2. **关注增速质量**：毛利率与收入增速的结合判断增长健康度
3. **先导指标重要**：研发费用、销售费用、合同负债等可预示未来趋势
4. **数据真实性**：基于计算的客观指标，避免编造数据

## 输出要求

- 结论明确，逻辑严密
- 数据引用准确，避免主观臆断
- 重点突出，区分核心与辅助指标
- 专业术语准确，表达简洁
"""

ANALYZE_CORE_INDICATORS_PROMPT = """请分析以下核心财务指标：

## 公司信息
- 公司名称：{company_name}
- 报告期：{report_period}
- 行业：{industry}

## 核心指标数据
{core_indicators_data}

## 分析要求

### 1. 营业收入增速分析
- 分析总收入增速的绝对值和同比变化
- 如果有细分板块数据，重点分析各板块增速差异
- 说明核心增长驱动因素
- 结合行业背景判断增速可持续性

### 2. 净利润增速分析
- 分析净利润增速，对比收入增速
- 评估盈利质量（如利润增速低于收入增速的原因）
- 评估利润的可调节性

## 输出格式

### 营业收入分析
[具体分析内容，需包含数据支撑]

### 净利润分析
[具体分析内容，需包含数据支撑]

### 核心结论
[总结性结论，30-50字]
"""

ANALYZE_AUXILIARY_INDICATORS_PROMPT = """请分析以下辅助财务指标：

## 公司信息
- 公司名称：{company_name}
- 报告期：{report_period}

## 辅助指标数据
{auxiliary_indicators_data}

## 核心指标参考
{core_indicators_summary}

## 分析要求

### 1. 毛利率分析
- 计算整体毛利率及同比变化
- 结合收入增速分析：
  * 收入增速与毛利率同升（正向双击）：竞争力增强或行业景气
  * 收入增速高但毛利率下滑：警惕以价换量或竞争加剧
  * 毛利率稳定但收入低迷：需求疲软或产品竞争力不足
- 如有分板块数据，需分板块分析

### 2. 研发费用率分析
- 分析研发费用绝对值及占收入比重的变化
- 研发费用大幅增长：可能预示战略投入（如AI、新产品线）
- 研发人员数量变化与收入增速的关联性
- 强调研发费用的低造假性，作为战略真实性的参考

### 3. 销售费用率分析
- 对比销售费用率与收入增速
- 销售费用率下降伴随高增速：增长良性（品牌效应或复购提升）
- 销售费用率激增但增速未跟上：市场拓展受阻或竞争激烈
- 区分项目制（商务费用）与产品制（投流费用）

## 输出格式

### 毛利率分析
[具体分析内容]

### 研发费用率分析
[具体分析内容]

### 销售费用率分析
[具体分析内容]

### 辅助结论
[总结性结论，30-50字]
"""

ANALYZE_SPECIFIC_INDICATORS_PROMPT = """请分析以下个性化财务指标：

## 公司信息
- 公司名称：{company_name}
- 报告期：{report_period}
- 业务类型：{business_type}

## 个性化指标数据
{specific_indicators_data}

## 分析要求

### 1. 合同负债分析（针对订阅制/SaaS公司）
- 分析合同负债环比变化
- 合同负债增长：预示未来收入确定性高
- 合同负债停滞或下滑：需排查客户流失或订阅周期问题

### 2. 存货变化分析（针对硬件/算力公司）
- 分析存货绝对值变化
- 存货增长：可能反映订单储备充足，预示未来收入
- 存货激增但收入未兑现：警惕滞销或供应链风险

## 输出格式

### [适用指标名称]分析
[具体分析内容]

### 先导信号判断
[总结性结论，30-50字]

如果没有适用的个性化指标，请输出：
无适用的个性化指标数据。
"""

GENERATE_COMPREHENSIVE_REPORT_PROMPT = """请基于以下分析生成完整的财报点评报告：

## 公司信息
- 公司名称：{company_name}
- 报告期：{report_period}
- 行业：{industry}

## 已完成的分析
### 核心指标分析
{core_analysis}

### 辅助指标分析
{auxiliary_analysis}

### 个性化指标分析
{specific_analysis}

## 非结构化数据参考
{unstructured_context}

## 报告结构要求

### 1. 核心结论（100-150字）
概括公司成长性（收入增速为核心）、盈利趋势及关键风险

### 2. 分项分析
按指标优先级展开，每项包含：
- 数据事实陈述
- 行业对比（如有历史数据）
- 业务含义解读

### 3. 综合判断
- **增长质量**：结合毛利率、费用率评估增速健康度
- **战略有效性**：通过研发/销售费用分析公司布局
- **先导信号**：合同负债/存货对未来收入的指示作用

### 4. 投资建议
明确看多/中性/看空逻辑，如：
- "高收入增速+毛利提升"为强势买入信号
- "增速放缓+费用率攀升"提示风险

## 注意事项
1. 优先基于最新季度/年度数据，避免过度依赖历史表现
2. 对异常数据（如收入增速与利润背离）需重点解释原因
3. 强调计算机行业"成长性优于利润"的特性
4. 所有数据引用必须来自提供的分析结果，不得编造

## 输出格式

# {company_name} {report_period} 财报点评

**行业**：{industry}  
**报告日期**：[当前日期]

---

## 1. 核心结论

[100-150字的核心结论]

## 2. 分项分析

### 2.1 收入增速及细分板块分析

[详细分析]

### 2.2 利润及盈利质量分析

[详细分析]

### 2.3 毛利率分析

[详细分析]

### 2.4 研发费用及战略投入分析

[详细分析]

### 2.5 销售费用及增长效率分析

[详细分析]

### 2.6 个性化指标分析（如适用）

[详细分析]

## 3. 综合判断

### 3.1 增长质量

[分析]

### 3.2 战略有效性

[分析]

### 3.3 先导信号

[分析]

## 4. 投资建议

**评级**：[买入/增持/中性/减持/卖出]

**核心逻辑**：[理由说明]

**风险提示**：[关键风险]

---

*本报告基于公开财务数据及行业分析生成，不构成投资建议，投资需谨慎。*
"""


# ==================== 提示词模板管理器 ====================

class PromptManager:
    """提示词管理器"""
    
    @staticmethod
    def get_system_prompt(industry: str) -> str:
        """获取系统提示词"""
        prompts = {
            "computer": COMPUTER_INDUSTRY_ANALYSIS_SYSTEM_PROMPT,
        }
        return prompts.get(industry, COMPUTER_INDUSTRY_ANALYSIS_SYSTEM_PROMPT)
    
    @staticmethod
    def get_core_analysis_prompt() -> str:
        """获取核心指标分析提示词"""
        return ANALYZE_CORE_INDICATORS_PROMPT
    
    @staticmethod
    def get_auxiliary_analysis_prompt() -> str:
        """获取辅助指标分析提示词"""
        return ANALYZE_AUXILIARY_INDICATORS_PROMPT
    
    @staticmethod
    def get_specific_analysis_prompt() -> str:
        """获取个性化指标分析提示词"""
        return ANALYZE_SPECIFIC_INDICATORS_PROMPT
    
    @staticmethod
    def get_report_generation_prompt() -> str:
        """获取报告生成提示词"""
        return GENERATE_COMPREHENSIVE_REPORT_PROMPT


# 全局提示词管理器实例
prompt_manager = PromptManager()

