# å¾®æœåŠ¡æ¶æ„é‡æ„è¯´æ˜

## ğŸ“‹ é‡æ„æ¦‚è¿°

å°†åŸæœ¬çš„å•ä½“åº”ç”¨é‡æ„ä¸ºå¾®æœåŠ¡æ¶æ„ï¼Œå®ç°æœåŠ¡è§£è€¦å’Œç‹¬ç«‹éƒ¨ç½²ã€‚

## ğŸ—ï¸ æ¶æ„å¯¹æ¯”

### é‡æ„å‰ï¼ˆå•ä½“æ¶æ„ï¼‰

```
è´¢æŠ¥ç‚¹è¯„ä¸»åº”ç”¨
â”œâ”€â”€ ç›´æ¥è¿æ¥ PostgreSQL æ•°æ®åº“
â”œâ”€â”€ ç›´æ¥åŠ è½½ Embedding æ¨¡å‹
â””â”€â”€ å‘é‡æ•°æ®åº“ (Milvus)
```

**é—®é¢˜**ï¼š
- âŒ èµ„æºè€¦åˆï¼ˆæ•°æ®åº“ã€æ¨¡å‹éƒ½åœ¨ä¸»åº”ç”¨ï¼‰
- âŒ éš¾ä»¥æ‰©å±•ï¼ˆæ— æ³•ç‹¬ç«‹æ‰©å±•å„æœåŠ¡ï¼‰
- âŒ ç»´æŠ¤å›°éš¾ï¼ˆä¿®æ”¹éœ€è¦é‡å¯æ•´ä¸ªåº”ç”¨ï¼‰

### é‡æ„åï¼ˆå¾®æœåŠ¡æ¶æ„ï¼‰âœ…

```
è´¢æŠ¥ç‚¹è¯„ä¸»åº”ç”¨ (ä¸»æœåŠ¡)
    â†“ HTTP
â”œâ”€â”€ è´¢æŠ¥æ•°æ®æœåŠ¡ (8081ç«¯å£)
â”‚   â””â”€â”€ PostgreSQL æ•°æ®åº“
â”‚
â”œâ”€â”€ EmbeddingæœåŠ¡ (8080ç«¯å£)
â”‚   â””â”€â”€ bge-base-zh-v1.5 æ¨¡å‹
â”‚
â””â”€â”€ Milvus å‘é‡æ•°æ®åº“
```

**ä¼˜åŠ¿**ï¼š
- âœ… æœåŠ¡è§£è€¦ï¼ˆå„æœåŠ¡ç‹¬ç«‹è¿è¡Œï¼‰
- âœ… æ˜“äºæ‰©å±•ï¼ˆå¯ç‹¬ç«‹æ‰©å±•å„æœåŠ¡å®ä¾‹ï¼‰
- âœ… ç»´æŠ¤æ–¹ä¾¿ï¼ˆæœåŠ¡ç‹¬ç«‹æ›´æ–°ã€é‡å¯ï¼‰
- âœ… èµ„æºéš”ç¦»ï¼ˆå„æœåŠ¡ç‹¬ç«‹å ç”¨èµ„æºï¼‰

## ğŸ“¦ æœåŠ¡æ¸…å•

### 1. ä¸»åº”ç”¨ (fin-report-reviewer)
- **ç«¯å£**: 8000 (API) + 8501 (Streamlit)
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘ã€LangGraphå·¥ä½œæµã€æŠ¥å‘Šç”Ÿæˆ
- **ä¾èµ–**: è´¢æŠ¥æ•°æ®æœåŠ¡ã€EmbeddingæœåŠ¡ã€Milvus

### 2. è´¢æŠ¥æ•°æ®æœåŠ¡ (financial-data-service)
- **ç«¯å£**: 8081
- **èŒè´£**: å°è£…PostgreSQLæŸ¥è¯¢ï¼Œæä¾›REST API
- **ä¾èµ–**: PostgreSQLæ•°æ®åº“
- **æ–‡æ¡£**: `financial-data-service/README.md`

### 3. EmbeddingæœåŠ¡ (emb-server)
- **ç«¯å£**: 8080
- **èŒè´£**: æ–‡æœ¬å‘é‡åŒ–ï¼Œæä¾›REST API
- **ä¾èµ–**: bge-base-zh-v1.5 æ¨¡å‹ï¼ˆæœ¬åœ°æˆ–ç¼“å­˜ï¼‰
- **æ–‡æ¡£**: `emb-server/README.md`

### 4. Milvuså‘é‡æ•°æ®åº“
- **ç«¯å£**: 19530
- **èŒè´£**: å­˜å‚¨å’Œæ£€ç´¢è´¢æŠ¥æ–‡æœ¬å‘é‡
- **éƒ¨ç½²**: ç‹¬ç«‹éƒ¨ç½²ï¼ˆDockeræ¨èï¼‰

### 5. PostgreSQLæ•°æ®åº“
- **ç«¯å£**: 5432
- **èŒè´£**: å­˜å‚¨ç»“æ„åŒ–è´¢æŠ¥æ•°æ®
- **éƒ¨ç½²**: ç‹¬ç«‹éƒ¨ç½²

## ğŸš€ å¯åŠ¨é¡ºåº

### 1. å¯åŠ¨åŸºç¡€æœåŠ¡

```bash
# 1. å¯åŠ¨ PostgreSQL (å¦‚æœæœªå¯åŠ¨)
# 2. å¯åŠ¨ Milvus (å¦‚æœæœªå¯åŠ¨)
```

### 2. å¯åŠ¨å¾®æœåŠ¡

```bash
# ç»ˆç«¯ 1: å¯åŠ¨è´¢æŠ¥æ•°æ®æœåŠ¡
cd financial-data-service
python financial_data_server.py \
  --host 0.0.0.0 \
  --port 8081 \
  --database-url "postgresql://user:password@localhost:5432/financial_reports"

# ç»ˆç«¯ 2: å¯åŠ¨EmbeddingæœåŠ¡
cd emb-server
python embedding_server.py \
  --host 0.0.0.0 \
  --port 8080 \
  --model BAAI/bge-base-zh-v1.5 \
  --device cuda \
  --cache-dir ./models
```

### 3. é…ç½®ä¸»åº”ç”¨

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# å¾®æœåŠ¡é…ç½®
FINANCIAL_DATA_API_URL=http://localhost:8081
FINANCIAL_DATA_API_TIMEOUT=30

EMBEDDING_SERVICE_TYPE=http
EMBEDDING_API_URL=http://localhost:8080
EMBEDDING_API_TIMEOUT=60

# Milvusé…ç½®
MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_USER=your_user
MILVUS_PASSWORD=your_password
```

### 4. å¯åŠ¨ä¸»åº”ç”¨

```bash
# ç»ˆç«¯ 3: å¯åŠ¨ä¸»åº”ç”¨
python app.py
```

## ğŸ“ é…ç½®å˜æ›´

### env.example æ›´æ–°

```bash
# ==================== å¾®æœåŠ¡é…ç½® ====================
# è´¢æŠ¥æ•°æ®æœåŠ¡ (HTTP)
FINANCIAL_DATA_API_URL=http://localhost:8081
FINANCIAL_DATA_API_TIMEOUT=30

# EmbeddingæœåŠ¡ (HTTP)
EMBEDDING_SERVICE_TYPE=http
EMBEDDING_API_URL=http://localhost:8080
EMBEDDING_API_TIMEOUT=60

# ==================== æ•°æ®åº“é…ç½® (å·²å¼ƒç”¨) ====================
# ä¸»åº”ç”¨ä¸å†ç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œæ”¹ç”¨HTTPæœåŠ¡
# DATABASE_URL=postgresql://...
```

## ğŸ”§ ä»£ç å˜æ›´

### 1. æ–°å¢HTTPå®¢æˆ·ç«¯

**æ–‡ä»¶**: `src/clients/financial_data_http_client.py`

```python
from src.clients import FinancialDataHttpClient

# ä½¿ç”¨HTTPå®¢æˆ·ç«¯æ›¿ä»£ç›´æ¥æ•°æ®åº“è¿æ¥
client = FinancialDataHttpClient()
data = client.get_income_statement("000001", "2024-03-31")
```

### 2. æ›´æ–°Tools

**æ–‡ä»¶**: `src/tools/financial_data_tools.py`

```python
# æ—§ä»£ç 
from src.database.financial_data_service import FinancialDataService

# æ–°ä»£ç 
from src.clients.financial_data_http_client import FinancialDataHttpClient
```

### 3. ä¿ç•™å‘åå…¼å®¹

**æ–‡ä»¶**: `src/database/__init__.py`

```python
# ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ¨èHTTPæ–¹å¼
from src.database.financial_data_service import FinancialDataService  # ç›´æ¥æ•°æ®åº“
from src.clients import FinancialDataHttpClient  # HTTPæ–¹å¼ï¼ˆæ¨èï¼‰
```

## âœ… éªŒè¯æ­¥éª¤

### 1. éªŒè¯æœåŠ¡è¿æ¥

```bash
# è´¢æŠ¥æ•°æ®æœåŠ¡
curl http://localhost:8081/health

# EmbeddingæœåŠ¡
curl http://localhost:8080/health
```

### 2. æµ‹è¯•API

```bash
# æµ‹è¯•è´¢æŠ¥æŸ¥è¯¢
curl -X POST http://localhost:8081/api/income-statement \
  -H "Content-Type: application/json" \
  -d '{"stock_code": "000001", "report_period": "2024-03-31"}'

# æµ‹è¯•Embeddingç”Ÿæˆ
curl -X POST http://localhost:8080/embeddings \
  -H "Content-Type: application/json" \
  -d '{"texts": ["æµ‹è¯•æ–‡æœ¬"]}'
```

### 3. è¿è¡Œä¸»åº”ç”¨æµ‹è¯•

```bash
# åœ¨ä¸»åº”ç”¨ä¸­æµ‹è¯•
python test_report_generation.py
```

## ğŸ¯ è¿ç§»å»ºè®®

### é˜¶æ®µ1: å¹¶è¡Œè¿è¡Œï¼ˆæ¨èï¼‰

1. å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡
2. ä¸»åº”ç”¨é€šè¿‡é…ç½®åˆ‡æ¢åˆ°HTTPæ¨¡å¼
3. éªŒè¯åŠŸèƒ½æ­£å¸¸
4. è§‚å¯Ÿè¿è¡Œä¸€æ®µæ—¶é—´

### é˜¶æ®µ2: å®Œå…¨åˆ‡æ¢

1. ç§»é™¤ä¸»åº”ç”¨çš„ç›´æ¥æ•°æ®åº“ä¾èµ–
2. åˆ é™¤ `DATABASE_URL` é…ç½®
3. æ›´æ–°éƒ¨ç½²æ–‡æ¡£

### é˜¶æ®µ3: å®¹å™¨åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```yaml
# docker-compose.yml ç¤ºä¾‹
version: '3.8'
services:
  financial-data-service:
    build: ./financial-data-service
    ports:
      - "8081:8081"
    environment:
      - DATABASE_URL=postgresql://...
  
  embedding-service:
    build: ./emb-server
    ports:
      - "8080:8080"
    volumes:
      - ./models:/models
  
  main-app:
    build: .
    ports:
      - "8000:8000"
      - "8501:8501"
    depends_on:
      - financial-data-service
      - embedding-service
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | å•ä½“æ¶æ„ | å¾®æœåŠ¡æ¶æ„ |
|------|---------|-----------|
| **å¯åŠ¨æ—¶é—´** | æ…¢ï¼ˆåŠ è½½æ‰€æœ‰èµ„æºï¼‰ | å¿«ï¼ˆæŒ‰éœ€å¯åŠ¨ï¼‰ |
| **å†…å­˜å ç”¨** | é«˜ï¼ˆæ‰€æœ‰èµ„æºåœ¨ä¸€èµ·ï¼‰ | åˆ†æ•£ï¼ˆå„æœåŠ¡ç‹¬ç«‹ï¼‰ |
| **æ‰©å±•æ€§** | å·®ï¼ˆæ•´ä½“æ‰©å±•ï¼‰ | å¥½ï¼ˆç‹¬ç«‹æ‰©å±•ï¼‰ |
| **ç»´æŠ¤æ€§** | å·®ï¼ˆç‰µä¸€å‘åŠ¨å…¨èº«ï¼‰ | å¥½ï¼ˆæœåŠ¡ç‹¬ç«‹ï¼‰ |
| **ç½‘ç»œå¼€é”€** | æ—  | æœ‰ï¼ˆHTTPè°ƒç”¨ï¼‰ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œå»¶è¿Ÿ**: HTTPè°ƒç”¨ä¼šå¢åŠ ç½‘ç»œå»¶è¿Ÿï¼ˆé€šå¸¸å¯å¿½ç•¥ï¼‰
2. **æœåŠ¡ä¾èµ–**: ä¸»åº”ç”¨ä¾èµ–å¾®æœåŠ¡ï¼Œéœ€ç¡®ä¿æœåŠ¡å¯ç”¨
3. **é”™è¯¯å¤„ç†**: éœ€è¦å¤„ç†ç½‘ç»œé”™è¯¯å’ŒæœåŠ¡ä¸å¯ç”¨æƒ…å†µ
4. **ç›‘æ§**: å»ºè®®æ·»åŠ æœåŠ¡ç›‘æ§å’Œå‘Šè­¦
5. **å®‰å…¨**: ç”Ÿäº§ç¯å¢ƒéœ€è¦æ·»åŠ è®¤è¯å’Œé‰´æƒ

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è´¢æŠ¥æ•°æ®æœåŠ¡æ–‡æ¡£](../financial-data-service/README.md)
- [EmbeddingæœåŠ¡æ–‡æ¡£](../emb-server/README.md)
- [é…ç½®è¯´æ˜](../env.example)

## ğŸ“Œ æ€»ç»“

é‡æ„ä¸ºå¾®æœåŠ¡æ¶æ„åï¼š
- âœ… æœåŠ¡ç‹¬ç«‹éƒ¨ç½²å’Œç»´æŠ¤
- âœ… èµ„æºéš”ç¦»ï¼Œäº’ä¸å½±å“
- âœ… æ˜“äºæ‰©å±•å’Œå‡çº§
- âœ… ç¬¦åˆå¾®æœåŠ¡æœ€ä½³å®è·µ

